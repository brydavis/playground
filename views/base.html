<!DOCTYPE html>
<html>
<head>
	<title>Playground</title>
	<script type="text/javascript" src="static/js/test.js"></script>
	<link rel="icon" type="image/x-icon" href="static/favicon.ico">
	<script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="static/css/main.css">



</head>
<body>
	<div class="header">
		<header>
			<a href="/">		
				<p class="header lead">PLAYGO</p>
			</a>
			<a href="">
				<p class="menu lead"><span class="menu">&#9776;</span></p>
			</a>
		</header>
	</div>
	<div class="content">
		<form action="/" method="post" spellcheck="false">
			<div class="textarea">
				<button type="submit" id="editor" class="submit h5">RUN</button>
				<div class="linenums"></div>
				<textarea name="data" id="data">{{ printf "%s" .Code }}</textarea>
			</div>
			<div class="output">
				<div class="pre">{{ printf "%s" .Text }}</div>
			</div>
		</form>
	</div>

	<script type="text/javascript">

		var map = {13: false, 16: false};

		$(document)
			.ready(function() {
				linesCode()
				$("textarea").allowTabChar()
				$("textarea").keyup(linesCode)
					$(".output").height($(document).height())				
			})
			.keydown(function(e) {
			    if (e.keyCode in map) {
			        map[e.keyCode] = true;
			        if (map[13] && map[16]) {
						e.preventDefault()
			            $("button#editor").click()
			        }
			    }
			}).keyup(function(e) {
			    if (e.keyCode in map) {
			        map[e.keyCode] = false;
			    }
			})

		function linesCode () {
			var linenums = $("div.linenums")
			linenums.html("")
			var code = $("textarea").val()
			var lines = code.match(/\n/gmi)
			for (var i = 1; i <= lines.length+50; i++) {
				linenums.append("<div class=\"num\">"+i+"</div>")
			}
		}

		(function($) {
		    function pasteIntoInput(el, text) {
		        el.focus()
		        if (typeof el.selectionStart == "number") {
		            var val = el.value
		            var selStart = el.selectionStart
		            el.value = val.slice(0, selStart) + text + val.slice(el.selectionEnd)
		            el.selectionEnd = el.selectionStart = selStart + text.length
		        } else if (typeof document.selection != "undefined") {
		            var textRange = document.selection.createRange()
		            textRange.text = text
		            textRange.collapse(false)
		            textRange.select()
		        }
		    }

		    function allowTabChar(el) {
		        $(el).keydown(function(e) {
		            if (e.which == 9) {
		                pasteIntoInput(this, "\t")
		                return false
		            }
		        })

		        // For Opera, which only allows suppression of keypress events, not keydown
		        $(el).keypress(function(e) {
		            if (e.which == 9) {
		                return false
		            }
		        })
		    }

		    $.fn.allowTabChar = function() {
		        if (this.jquery) {
		            this.each(function() {
		                if (this.nodeType == 1) {
		                    var nodeName = this.nodeName.toLowerCase()
		                    if (nodeName == "textarea" || (nodeName == "input" && this.type == "text")) {
		                        allowTabChar(this)
		                    }
		                }
		            })
		        }
		        return this
		    }
		})(jQuery)

	</script>

</body>
</html>